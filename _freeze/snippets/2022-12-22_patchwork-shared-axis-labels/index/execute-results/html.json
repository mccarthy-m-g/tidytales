{
  "hash": "fa799670e38bd48368389ce318402822",
  "result": {
    "markdown": "---\ntitle: \"Shared axis labels in patchwork plots\"\ndescription: |\n  Getting shared axis labels in {patchwork} plots.\n\ndate: 2022-12-22\n\ncategories:\n  - .Visualize\n  - \"{ggplot2}\"\n  - \"{patchwork}\"\n\nparams:\n  use_renv: FALSE\n  data_file: NULL # Filename of data located in /data/\n  fair_dealing: FALSE\n---\n\n\n\n\n## Prerequisites\n\nTo access the datasets, help pages, and functions that we will use in this code snippet, load the following packages:\n\n\n::: {.cell opts.label='no.message'}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(patchwork)\n```\n:::\n\n\nThen make some data and **ggplot2** plots to be used in the patchwork.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhuron <- data.frame(year = 1875:1972, level = as.vector(LakeHuron))\nh <- ggplot(huron, aes(year))\n\nh1 <- h +\n  geom_ribbon(aes(ymin = level - 1, ymax = level + 1), fill = \"grey70\") +\n  geom_line(aes(y = level))\n\nh2 <- h + geom_area(aes(y = level))\n```\n:::\n\n\n## Shared x-axis labels\n\nWe set the bottom margin to 0 so the tag is in the same vertical position that the x-axis would otherwise be in.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create the patchwork, dropping the x-axis labels from the plots, and setting\n# the margins\nh_patch <- h1 + h2 & xlab(NULL) & theme(plot.margin = margin(5.5, 5.5, 0, 5.5))\n\n# Use the tag label as an x-axis label\nwrap_elements(panel = h_patch) +\n  labs(tag = \"year\") +\n  theme(\n    plot.tag = element_text(size = rel(1)),\n    plot.tag.position = \"bottom\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n## Shared y-axis labels\n\nWe set the left margin to 0 so the tag is in the same horizontal position that the y-axis would otherwise be in.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create the patchwork, dropping the y-axis labels from the plots, and setting\n# the margins\nh_patch <- h1 / h2 & ylab(NULL) & theme(plot.margin = margin(5.5, 5.5, 5.5, 0))\n\n# Use the tag label as a y-axis label\nwrap_elements(h_patch) +\n  labs(tag = \"level\") +\n  theme(\n    plot.tag = element_text(size = rel(1), angle = 90),\n    plot.tag.position = \"left\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n## Shared axis labels without using patchwork\n\n[Elio Campitelli](https://eliocamp.github.io) shared a solution [on Mastodon](https://mastodon.social/@eliocamp/109559635126510130) that accomplishes the same results as above, but without patchwork. It uses the magic tilde notation to create functions in the `data` argument of each geom that adds a grouping variable `var` that can be faceted on.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nh <- ggplot(huron, aes(year)) +\n  geom_ribbon(\n    data = ~ transform(.x, var = \"a\"),\n    aes(ymin = level - 1, ymax = level + 1),\n    fill = \"grey70\"\n  ) +\n  geom_line(data = ~ transform(.x, var = \"a\"), aes(y = level)) +\n  geom_area(data = ~ transform(.x, var = \"b\"), aes(y = level)) +\n  # Since we don't care about the facet strips here, we can remove them.\n  theme(\n    strip.text = element_blank(),\n    strip.background = element_blank()\n  )\n```\n:::\n\n\nFacet by rows for a shared x-axis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nh +\n  facet_wrap(vars(var), scales = \"free_y\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nFacet by columns for a shared y-axis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nh +\n  facet_wrap(vars(var), scales = \"free_y\", ncol = 1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n## {.appendix .unnumbered .unlisted}\n\n::: {.d-flex}\n\n![](/assets/images/avatar.png){fig-align=\"left\" fig-alt=\"Avatar\" .rounded .avatar}\n\n::: {}\n\n::: {}\n## Michael McCarthy {.quarto-appendix-heading}\n:::\n\nThanks for reading! I’m Michael, the voice behind Tidy Tales. I am an award winning data scientist and R programmer with the skills and experience to help you solve the problems you care about. You can learn more about me, my [consulting services](https://michaelmccarthy.tidytales.ca/consulting/), and my other projects on my [personal website](https://michaelmccarthy.tidytales.ca).\n:::\n\n:::\n\n## Comments {.appendix .unnumbered .unlisted}\n\n<details open>\n<summary></summary>\n::: {.giscus}\n:::\n</details>\n\n## Session Info {.appendix .unnumbered .unlisted}\n\n<details>\n<summary></summary>\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.2.2 (2022-10-31)\n os       macOS Mojave 10.14.6\n system   x86_64, darwin17.0\n ui       X11\n language (EN)\n collate  en_CA.UTF-8\n ctype    en_CA.UTF-8\n tz       America/Vancouver\n date     2022-12-22\n pandoc   2.14.0.3 @ /Applications/RStudio.app/Contents/MacOS/pandoc/ (via rmarkdown)\n quarto   1.2.280 @ /usr/local/bin/quarto\n\n─ Packages ───────────────────────────────────────────────────────────────────\n package     * version date (UTC) lib source\n ggplot2     * 3.4.0   2022-11-04 [1] CRAN (R 4.2.0)\n patchwork   * 1.1.2   2022-08-19 [1] CRAN (R 4.2.0)\n sessioninfo * 1.2.2   2021-12-06 [1] CRAN (R 4.2.0)\n\n [1] /Users/Michael/Library/R/x86_64/4.2/library/__tidytales\n [2] /Library/Frameworks/R.framework/Versions/4.2/Resources/library\n\n──────────────────────────────────────────────────────────────────────────────\n```\n:::\n:::\n</details>\n\n<!--\n## Data {.appendix .unnumbered .unlisted}\n\n[Download](/data/) the data used in this post.\n-->\n\n<!--\n## Fair Dealing {.appendix .unnumbered .unlisted}\n\nAny of the trademarks, service marks, collective marks, design rights or similar rights that are mentioned, used, or cited in this article are the property of their respective owners. They are used here as fair dealing for the purpose of education in accordance with [section 29 of the Copyright Act](https://laws-lois.justice.gc.ca/eng/acts/c-42/page-8.html#h-103270) and do not infringe copyright.\n-->\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}