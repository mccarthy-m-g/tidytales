{
  "hash": "880eeb058f7d43290a892aebcf2f4694",
  "result": {
    "markdown": "---\ntitle: \"Longitudinal Measurement Invariance\"\ndescription: |\n  Testing longitudinal measurement invariance with {lavaan} and {semTools}.\n\ndate: 11-01-2021\n\ncategories:\n  - .Model\n  - \"{lavaan}\"\n  - \"{semTools}\"\n  \nparams:\n  use_renv: FALSE\n  data_file: \"2021-11-01_social-exchanges.csv\" # Filename of data located in /data/\n  fair_dealing: FALSE\n---\n\n\n\n\n## Prerequisites\n\nTo access the datasets, help pages, and functions that we will use in this code snippet, load the following packages:\n\n\n::: {.cell opts.label='no.message'}\n\n```{.r .cell-code}\nlibrary(lavaan)\nlibrary(semTools)\n```\n:::\n\n\nAnd read in the data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsocial_exchanges <- read.csv(here(\"data\", \"2021-11-01_social-exchanges.csv\"))\n```\n:::\n\n\nThe data contains simulated values for several indicators of positive and negative social exchanges, measured on two occasions (`w1` and `w2`). There are three continuous indicators that measure perceived companionship (`vst1`, `vst2`, `vst3`), and three binary indicators that measure unwanted advice (`unw1`, `unw2`, `unw3`). The data and some of the examples come from [Longitudinal Structural Equation Modeling: A Comprehensive Introduction](http://www.longitudinalsem.com) by Jason Newsom.\n\n## Configural Invariance\n\nUsing the **lavaan** package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nconfigural_model_lav <- '\n  # Measurement model\n  w1comp =~ w1vst1 + w1vst2 + w1vst3\n  w2comp =~ w2vst1 + w2vst2 + w2vst3\n  \n  # Variances and covariances\n  w2comp ~~ w1comp\n  w1comp ~~ w1comp\n  w2comp ~~ w2comp\n\n  w1vst1 ~~ w1vst1\n  w1vst2 ~~ w1vst2\n  w1vst3 ~~ w1vst3\n  w2vst1 ~~ w2vst1\n  w2vst2 ~~ w2vst2\n  w2vst3 ~~ w2vst3\n\n  w1vst1 ~~ w2vst1\n\tw1vst2 ~~ w2vst2\n\tw1vst3 ~~ w2vst3\n'\n\nconfigural_model_lav_fit <- sem(configural_model_lav, data = social_exchanges)\n```\n:::\n\n\nUsing the **semTools** package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# First, define the configural model, using the repeated measures factors and\n# indicators.\nconfigural_model_smt <- '\n  # Measurement model\n  w1comp =~ w1vst1 + w1vst2 + w1vst3\n\tw2comp =~ w2vst1 + w2vst2 + w2vst3\n'\n\n# Second, create a named list indicating which factors are actually the same\n# latent variable measured repeatedly.\nlongitudinal_factor_names <- list(\n  comp = c(\"w1comp\", \"w2comp\")\n)\n\n# Third, generate the lavaan model syntax using semTools.\nconfigural_model_smt <- measEq.syntax(\n  configural.model = configural_model_smt,\n  longFacNames = longitudinal_factor_names,\n  ID.fac = \"std.lv\",\n  ID.cat = \"Wu.Estabrook.2016\",\n  data = social_exchanges\n)\nconfigural_model_smt <- as.character(configural_model_smt)\n\n# Finally, fit the model using lavaan.\nconfigural_model_smt_fit <- sem(configural_model_smt, data = social_exchanges)\n```\n:::\n\n\nCompare lavaan and semTools fit measures.\n\n\n::: {.column-margin}\nConfigural invariance is met if the model fits well, indicators load on the same factors, and loadings are all of acceptable magnitude. An alternative way of testing longitudinal configural invariance is to fit separate confirmatory factor models at each time point; configural invariance is met if the previously stated criteria hold and the measure has the same factor structure at each time point.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfitMeasures(configural_model_lav_fit, c(\"chisq\", \"df\", \"pvalue\", \"cfi\", \"rmsea\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>  chisq     df pvalue    cfi  rmsea \n#>  9.911  5.000  0.078  0.997  0.041\n```\n:::\n\n```{.r .cell-code}\nfitMeasures(configural_model_smt_fit, c(\"chisq\", \"df\", \"pvalue\", \"cfi\", \"rmsea\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>  chisq     df pvalue    cfi  rmsea \n#>  9.911  5.000  0.078  0.997  0.041\n```\n:::\n:::\n\n\n## Weak Invariance\n\nUsing the lavaan package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nweak_model_lav <- '\n  # Measurement model\n  w1comp =~ w1vst1 + a*w1vst2 + b*w1vst3 # Factor loading equality constraint\n\tw2comp =~ w2vst1 + a*w2vst2 + b*w2vst3 # Factor loading equality constraint\n\n  # Variances and covariances\n\tw2comp ~~ w1comp\n  w1comp ~~ w1comp\n  w2comp ~~ w2comp\n\n  w1vst1 ~~ w1vst1\n  w1vst2 ~~ w1vst2\n  w1vst3 ~~ w1vst3\n  w2vst1 ~~ w2vst1\n  w2vst2 ~~ w2vst2\n  w2vst3 ~~ w2vst3\n\n  w1vst1 ~~ w2vst1\n\tw1vst2 ~~ w2vst2\n\tw1vst3 ~~ w2vst3\n'\n\nweak_model_lav_fit <- sem(weak_model_lav, social_exchanges)\n```\n:::\n\n\nUsing the semTools package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nweak_model_smt <- measEq.syntax(\n  configural.model = configural_model_smt,\n  longFacNames = longitudinal_factor_names,\n  ID.fac = \"std.lv\",\n  ID.cat = \"Wu.Estabrook.2016\",\n  long.equal = c(\"loadings\"),\n  data = social_exchanges\n)\nweak_model_smt <- as.character(weak_model_smt)\n\nweak_model_smt_fit <- sem(weak_model_smt, data = social_exchanges)\n```\n:::\n\n\nCompare lavaan and semTools fit measures.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfitMeasures(weak_model_lav_fit, c(\"chisq\", \"df\", \"pvalue\", \"cfi\", \"rmsea\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>  chisq     df pvalue    cfi  rmsea \n#> 12.077  7.000  0.098  0.997  0.036\n```\n:::\n\n```{.r .cell-code}\nfitMeasures(weak_model_smt_fit, c(\"chisq\", \"df\", \"pvalue\", \"cfi\", \"rmsea\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>  chisq     df pvalue    cfi  rmsea \n#> 12.077  7.000  0.098  0.997  0.036\n```\n:::\n:::\n\n\nTest weak invariance.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlavTestLRT(configural_model_lav_fit, weak_model_lav_fit)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"Df\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"AIC\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"BIC\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Chisq\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Chisq diff\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Df diff\"],\"name\":[6],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Pr(>Chisq)\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"5\",\"2\":\"8852.555\",\"3\":\"8922.197\",\"4\":\"9.910754\",\"5\":\"NA\",\"6\":\"NA\",\"7\":\"NA\",\"_rn_\":\"configural_model_lav_fit\"},{\"1\":\"7\",\"2\":\"8850.721\",\"3\":\"8911.658\",\"4\":\"12.076741\",\"5\":\"2.165988\",\"6\":\"2\",\"7\":\"0.3385804\",\"_rn_\":\"weak_model_lav_fit\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n## Strong Invariance\n\nUsing the lavaan package.\n\n::: {.column-margin}\nEquality tests of factor variances should only be conducted when all factor loadings also are constrained to be equal over time. When all non-referent loadings are set equal in the constrained model, the chi-square is the same regardless of the referent.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstrong_model_lav <- '\n  # Measurement model\n  w1comp =~ w1vst1 + a*w1vst2 + b*w1vst3 # Factor loading equality constraint\n  w2comp =~ w2vst1 + a*w2vst2 + b*w2vst3 # Factor loading equality constraint\n\n  # Variances and covariances\n\tw2comp ~~ w1comp\n\tw2comp ~~ v*w2comp # Factor variance equality constraint\n\tw1comp ~~ v*w1comp # Factor variance equality constraint\n\n\tw1vst1 ~~ w2vst1\n\tw1vst2 ~~ w2vst2\n\tw1vst3 ~~ w2vst3\n'\n\nstrong_model_lav_fit <- sem(strong_model_lav, social_exchanges)\n```\n:::\n\n\nUsing the semTools package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Example 2.2\nstrong_model_smt <- measEq.syntax(\n  configural.model = configural_model_smt,\n  longFacNames = longitudinal_factor_names,\n  ID.fac = \"std.lv\",\n  ID.cat = \"Wu.Estabrook.2016\",\n  long.equal = c(\"loadings\", \"lv.variances\"),\n  data = social_exchanges\n)\nstrong_model_smt <- as.character(strong_model_smt)\n\nstrong_model_smt_fit <- sem(strong_model_smt, social_exchanges)\n```\n:::\n\n\nCompare lavaan and semTools fit measures.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfitMeasures(strong_model_lav_fit, c(\"chisq\", \"df\", \"pvalue\", \"cfi\", \"rmsea\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>  chisq     df pvalue    cfi  rmsea \n#> 37.553  8.000  0.000  0.983  0.080\n```\n:::\n\n```{.r .cell-code}\nfitMeasures(strong_model_smt_fit, c(\"chisq\", \"df\", \"pvalue\", \"cfi\", \"rmsea\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>  chisq     df pvalue    cfi  rmsea \n#> 37.553  8.000  0.000  0.983  0.080\n```\n:::\n:::\n\n\nTest strong invariance.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlavTestLRT(configural_model_lav_fit, weak_model_lav_fit, strong_model_lav_fit)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"Df\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"AIC\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"BIC\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Chisq\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Chisq diff\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Df diff\"],\"name\":[6],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Pr(>Chisq)\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"5\",\"2\":\"8852.555\",\"3\":\"8922.197\",\"4\":\"9.910754\",\"5\":\"NA\",\"6\":\"NA\",\"7\":\"NA\",\"_rn_\":\"configural_model_lav_fit\"},{\"1\":\"7\",\"2\":\"8850.721\",\"3\":\"8911.658\",\"4\":\"12.076741\",\"5\":\"2.165988\",\"6\":\"2\",\"7\":\"3.385804e-01\",\"_rn_\":\"weak_model_lav_fit\"},{\"1\":\"8\",\"2\":\"8874.197\",\"3\":\"8930.781\",\"4\":\"37.553074\",\"5\":\"25.476332\",\"6\":\"1\",\"7\":\"4.478432e-07\",\"_rn_\":\"strong_model_lav_fit\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n## Strict Invariance\n\nUsing the lavaan package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstrict_model_lav <- '\n  # Measurement model\n  w1comp =~ w1vst1 + a*w1vst2 + b*w1vst3 # Factor loading equality constraint\n\tw2comp =~ w2vst1 + a*w2vst2 + b*w2vst3 # Factor loading equality constraint\n\n  # Variances & covariances\n\tw2comp ~~ w1comp\n\n\tw1comp ~~ c*w1comp # Factor variance equality constraint\n\tw2comp ~~ c*w2comp # Factor variance equality constraint\n\n  w1vst1 ~~ w2vst1\n\tw1vst2 ~~ w2vst2\n\tw1vst3 ~~ w2vst3\n\n\tw1vst1 ~~ d*w1vst1 # Measurement residual equality constraint\n\tw1vst2 ~~ e*w1vst2 # Measurement residual equality constraint\n\tw1vst3 ~~ f*w1vst3 # Measurement residual equality constraint\n\n\tw2vst1 ~~ d*w2vst1 # Measurement residual equality constraint\n\tw2vst2 ~~ e*w2vst2 # Measurement residual equality constraint\n\tw2vst3 ~~ f*w2vst3 # Measurement residual equality constraint\n'\n\nstrict_model_lav_fit <- sem(strict_model_lav, social_exchanges)\n```\n:::\n\n\nUsing the semTools package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstrict_model_smt <- measEq.syntax(\n  configural.model = configural_model_smt,\n  longFacNames = longitudinal_factor_names,\n  ID.fac = \"std.lv\",\n  ID.cat = \"Wu.Estabrook.2016\",\n  long.equal = c(\"loadings\", \"lv.variances\", \"residuals\"),\n  data = social_exchanges\n)\nstrict_model_smt <- as.character(strict_model_smt)\n\nstrict_model_smt_fit <- sem(strict_model_smt, social_exchanges)\n```\n:::\n\n\nCompare lavaan and semTools fit measures.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfitMeasures(strict_model_lav_fit, c(\"chisq\", \"df\", \"pvalue\", \"cfi\", \"rmsea\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>  chisq     df pvalue    cfi  rmsea \n#> 78.779 11.000  0.000  0.961  0.104\n```\n:::\n\n```{.r .cell-code}\nfitMeasures(strict_model_smt_fit, c(\"chisq\", \"df\", \"pvalue\", \"cfi\", \"rmsea\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>  chisq     df pvalue    cfi  rmsea \n#> 78.779 11.000  0.000  0.961  0.104\n```\n:::\n:::\n\n\nTest strict invariance.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlavTestLRT(\n  configural_model_lav_fit,\n  weak_model_lav_fit,\n  strong_model_lav_fit,\n  strict_model_lav_fit\n)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"Df\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"AIC\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"BIC\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Chisq\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Chisq diff\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Df diff\"],\"name\":[6],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Pr(>Chisq)\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"5\",\"2\":\"8852.555\",\"3\":\"8922.197\",\"4\":\"9.910754\",\"5\":\"NA\",\"6\":\"NA\",\"7\":\"NA\",\"_rn_\":\"configural_model_lav_fit\"},{\"1\":\"7\",\"2\":\"8850.721\",\"3\":\"8911.658\",\"4\":\"12.076741\",\"5\":\"2.165988\",\"6\":\"2\",\"7\":\"3.385804e-01\",\"_rn_\":\"weak_model_lav_fit\"},{\"1\":\"8\",\"2\":\"8874.197\",\"3\":\"8930.781\",\"4\":\"37.553074\",\"5\":\"25.476332\",\"6\":\"1\",\"7\":\"4.478432e-07\",\"_rn_\":\"strong_model_lav_fit\"},{\"1\":\"11\",\"2\":\"8909.423\",\"3\":\"8952.949\",\"4\":\"78.778583\",\"5\":\"41.225509\",\"6\":\"3\",\"7\":\"5.857241e-09\",\"_rn_\":\"strict_model_lav_fit\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n## {.appendix .unnumbered .unlisted}\n\n::: {.d-flex}\n\n![](https://github.com/mccarthy-m-g/michaelmccarthy/raw/main/content/about/sidebar/avatar.png){fig-align=\"left\" fig-alt=\"Avatar\" .rounded .avatar}\n\n::: {}\n\n::: {}\n## Michael McCarthy {.quarto-appendix-heading}\n:::\n\nI am an award winning data scientist and R programmer creating data solutions for the problems you care about. I offer training consulting services to help you accomplish your goals at any point in your project lifecycle. I value building new connections and would love to discuss opportunities to work with you. Let’s get to know each other.\n:::\n\n:::\n\n## Comments {.appendix .unnumbered .unlisted}\n\n<details open>\n<summary></summary>\n::: {.giscus}\n:::\n</details>\n\n## Session Info {.appendix .unnumbered .unlisted}\n\n<details>\n<summary></summary>\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.1.1 (2021-08-10)\n os       macOS Mojave 10.14.6\n system   x86_64, darwin17.0\n ui       X11\n language (EN)\n collate  en_CA.UTF-8\n ctype    en_CA.UTF-8\n tz       America/Vancouver\n date     2022-10-31\n pandoc   2.14.0.3 @ /Applications/RStudio.app/Contents/MacOS/pandoc/ (via rmarkdown)\n quarto   1.2.247 @ /usr/local/bin/quarto\n\n─ Packages ───────────────────────────────────────────────────────────────────\n package     * version date (UTC) lib source\n here        * 1.0.1   2020-12-13 [1] CRAN (R 4.1.0)\n lavaan      * 0.6-11  2022-03-31 [1] CRAN (R 4.1.2)\n semTools    * 0.5-5   2021-07-07 [1] CRAN (R 4.1.0)\n sessioninfo * 1.2.2   2021-12-06 [1] CRAN (R 4.1.0)\n\n [1] /Users/Michael/Library/R/4.1/library\n [2] /Library/Frameworks/R.framework/Versions/4.1/Resources/library\n\n──────────────────────────────────────────────────────────────────────────────\n```\n:::\n:::\n</details>\n\n\n## Data {.appendix .unnumbered .unlisted}\n\n[Download](/data/2021-11-01_social-exchanges.csv) the data used in this post.\n\n\n<!--\n## Fair Dealing {.appendix .unnumbered .unlisted}\n\nAny of the trademarks, service marks, collective marks, design rights or similar rights that are mentioned, used, or cited in this article are the property of their respective owners. They are used here as fair dealing for the purpose of education in accordance with [section 29 of the Copyright Act](https://laws-lois.justice.gc.ca/eng/acts/c-42/page-8.html#h-103270) and do not infringe copyright.\n-->\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}