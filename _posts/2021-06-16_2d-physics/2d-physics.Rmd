---
draft: true
title: 2D Physics
description: |
  A template description.
author:
  - name: Michael McCarthy 
    url: ../../about.html
    affiliation: 
date: '2021-06-16'
categories:
  - 
repository_url: https://github.com/mccarthy-m-g/tidytales
output:
  distill::distill_article:
    self_contained: false
    toc: true
---

```{r setup, include=FALSE}
# Ensure the project root is set up correctly using {here} --------------------
here::i_am("_posts/yyyy-mm-dd_post-name/post_name.Rmd")

# Load general set up packages used in all posts ------------------------------
library(here)

# Load R scripts located in R/ ------------------------------------------------

# Set default options for knitr code chunks -----------------------------------
knitr::opts_chunk$set(comment = "#>",
                      echo = TRUE)

# Create templates for knitr code chunks --------------------------------------
knitr::opts_template$set(
  fig.graphic = list(echo = FALSE, out.width = "100%"),
  no.message = list(message = FALSE, warning = FALSE)
)
```

```{r meta, include=FALSE, results='asis'}
library(metathis)

meta() %>%
  meta_social(
    title = "Tidy Tales: ...",
    url = "https://tidytales.ca/posts/yyyy-mm-dd_post-name/",
    image = "https://tidytales.ca/posts/yyyy-mm-dd_post-name/images/post-name_card.png",
    image_alt = "Hero image of plot and Tidy Tales logo",
    image_width = 1200,
    image_height = 628,
    og_type = "article",
    twitter_card_type = "summary_large_image",
  )
```

## Overview

showcase gganimate and patchwork if I can get it working with gganimate

## R

```{r requirements-setup}
library(tidyverse)
```

https://www.khanacademy.org/science/physics/one-dimensional-motion/kinematic-formulas/a/what-are-the-kinematic-formulas

### Horizontal velocity (no air resistance)

$$
\Delta x = v_x t
$$

```{r}
velocity_x <- 5
time_interval <- 10
displacement_x <- velocity_x * time_interval
```

### Vertical velocity

$$
\Delta y = v_{0y} t + 0.5 a_y t^2
$$

```{r}
initial_velocity_y <- 0
gravity <- -9.81
displacement_y <-
  initial_velocity_y * time_interval +
  0.5 * gravity * time_interval^2
```

### Position

```{r}
height <- 100
velocity_x <- 5
velocity_y <- -9.81

x <- map_dbl(c(0:time_interval), ~ {
  0 + .x * 5
})

y <- map_dbl(c(0:time_interval), ~ {
  height - .x * 9.81 * .x^2
})

trajectory <- tibble(x = x, y = y, second = 0:time_interval)
```

```{r}
# library(gganimate)
# ggplot(trajectory, aes(x = x, y = y)) +
#   geom_point() +
#   transition_time(second)
```


solve time to hit ground in free fall with no initial velocity

$$
\mathit{time} = \sqrt{
  \frac{\mathit{height}}{\mathit{gravity} * 0.5}
}
$$

```{r}
freefall_time <- function(height, gravity = 9.80665) {
  sqrt(height / (gravity * 0.5))
}
```




```{r good-equations}
# https://www.omnicalculator.com/physics/projectile-motion
velocity_x <- function(velocity, angle) {
  velocity * cos(angle * (pi/180))
}

velocity_y <- function(velocity, angle) {
  # Degrees need to be converted to radians in sin() since that is what the
  # function uses
  velocity * sin(angle * (pi/180))
}

flight_time <- function(velocity_y, height, gravity = 9.80665) {
  ( velocity_y + sqrt(velocity_y^2 + 2 * gravity * height) ) / gravity
}

distance <- function(velocity_x, velocity_y, height, gravity = 9.80665) {
  velocity_x * ( velocity_y + sqrt(velocity_y^2 + 2 * gravity * height) ) / gravity
}

height_max <- function(velocity_y, height, gravity = 9.80665) {
  height + velocity_y^2 / (2 * gravity)
}


#' nframes and fps can be used to animate the trajectory as close to real time as possible.
#' There will be some rounding error though so it won't be exactly the same as the flight
#' time.
# TODO: Calculate vertical velocity at a given frame. Horizontal velocity is constant since
# there's no air resistance.
projectile_motion <- function(velocity, angle, height, gravity = 9.80665, nframes = 30) {
  
  # Velocity components
  vx <- velocity_x(velocity, angle)
  vy <- velocity_y(velocity, angle)
  # Flight components
  t  <- flight_time(vy, height, gravity)
  d  <- distance(vx, vy, height, gravity)
  # Max height components
  hm <- height_max(vy, height, gravity)
  th <- vy / gravity
  hd <- vx * th
  
  # Calculate the position of the projectile in 2D space at a given point in
  # time to approximate its trajectory over time
  x_pos <- map_dbl(seq(0, t, length = nframes), ~ {
    vx * .x
  })
  
  y_pos <- map_dbl(seq(0, t, length = nframes), ~ {
    height + ( vy * .x + 0.5 * -gravity * .x^2 )
  })
  
  # Calculate the vertical velocity of the projectile at a given point in time
  vy_t  <- map_dbl(seq(0, t, length = nframes), ~ {
    vy - gravity * .x
  })
  
  trajectory <- data.frame(
    x = x_pos,
    y = y_pos,
    vx = vx,
    vy = vy_t,
    second = seq(0, t, length = nframes)
  )
  
  # Return a list with all calculated values
  list(
    velocity_x = vx,
    velocity_y = vy,
    flight_time = t,
    distance = d,
    max_height = hm,
    max_height_time = th,
    max_height_dist = hd,
    trajectory = trajectory,
    nframes = nframes,
    fps = nframes/t
  )
}



```

approximate real time.

note: for the static line to work it seems like the time variable cannot be present in the dataframe used to plot the line. https://github.com/thomasp85/gganimate/issues/94

```{r}
library(glue)
library(formattable)
library(ggtext)
test_trajectory <- projectile_motion(11.4, 52.1, 18, nframes = 100)
test_trajectory2 <- select(test_trajectory$trajectory, x, y, vy)

anim_plot <- ggplot(test_trajectory$trajectory, aes(x = x, y = y)) +
  geom_vline(xintercept = test_trajectory$max_height_dist, linetype = "dashed") +
  geom_line(data = test_trajectory2,
            aes(x = x, y = y, group = 1),
            colour = "red",
            alpha = 0.1) +
  geom_point() +
  transition_time(second) +
  labs(
    title = "Projectile motion",
    subtitle = str_c(
      "Time (s): ",
      "{formattable(frame_time, digits = 2, format = 'f')}",
      " | ",
      "Velocity<sub>y</sub> (m/s): ",
      "{formattable(test_trajectory$trajectory$vy[test_trajectory$trajectory$second == frame_time], digits = 2, format = 'f')}"
    ),
    x = "Distance (m)",
    y = "Height (m)",
    caption = "Graphic: Michael McCarthy"
  ) +
  theme(plot.subtitle = element_markdown())

# Note: the following works after {gifski} and {png} are installed. Otherwise {magick}'s
# renderer is used, and that only allows fps that are factors of 100.
# Note 2: Adding pauses takes time away from the animation, making it so it does not play
# in near real time. Rather than using `duration`, using `nframes` and `fps` together works
# if the number of frames in `start_pause` and `end_pause` is added to `nframes`.
animate(anim_plot,
        nframes = test_trajectory$nframes + 20,
        fps = test_trajectory$fps,
        #duration = test_trajectory$flight_time,
        start_pause = 10, end_pause = 10,
        device = "ragg_png",
        res = 300,
        scaling = 0.5)
```

Making labels other than frame data work:
https://github.com/thomasp85/gganimate/issues/252#issuecomment-450846868
https://stackoverflow.com/a/55527316

ggtext can be used to enable formatting (such as sub and superscripts) for labels that include curly brace expressions by theming a given element with `element_markdown()`

```{r}
ggplot(dat = data.frame(x=1:10,y=1:10), aes(x=x,y=y)) +
  geom_point() +
  geom_line(data = data.frame(x2 = 1:10, y = 1:10),
            aes(x = x2, y = y, group = 1)) +
  transition_time(x)
```


`shadow_wake()` is quite interesting. The wake gets farther from the projectile as its speed increases.

```{r}
library(gganimate)
ggplot(test_trajectory$trajectory, aes(x = x, y = y, group = 1)) +
  geom_point() +
  geom_vline(xintercept = test_trajectory$max_height_dist) +
  transition_time(test_trajectory$trajectory$second) +
  shadow_wake(wake_length = 0.05)
```



```{r}
gravity <- 9.80665
velocity_0 <- 0
velocity   <- "unknown"
time       <- "unknown"
height     <- 200

200 = 0 * time + 0.5 * gravity * time^2

library(Ryacas)

yac_str("Solve(0 == 8.995559 - 9.80665 * t, t)")
```







### Wrangle

### Visualize

## Final Graphic

```{r final-plot, echo=FALSE, preview=TRUE}

```

## Comments {.appendix}

<details open class="comment-section">
   <summary>
   </summary>
</details>

## Data Source {.appendix}

Download the data used in this article with `tidytuesdayR::tt_load("yyyy-mm-dd")`.

## Session Info {.appendix}

<details class="session-info">
   <summary>
   </summary>
```{r session-info, echo=FALSE}
sessionInfo()
```
</details>

## Fair Dealing {.appendix}

Any of the trademarks, service marks, collective marks, design rights or similar rights that are mentioned, used, or cited in this article are the property of their respective owners. They are used here as fair dealing for the purpose of education in accordance with [section 29 of the Copyright Act](https://laws-lois.justice.gc.ca/eng/acts/c-42/page-8.html#h-103270) and do not infringe copyright.
