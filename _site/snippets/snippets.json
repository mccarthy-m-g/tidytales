[
  {
    "path": "snippets/2021-11-01_longitudinal-measurement-invariance/",
    "title": "Longitudinal Measurement Invariance",
    "description": "Testing longitudinal measurement invariance with {lavaan} and {semTools}.",
    "author": [
      {
        "name": "Michael McCarthy",
        "url": {}
      }
    ],
    "date": "2021-11-01",
    "categories": [
      ".Model",
      "{lavaan}",
      "{semTools}"
    ],
    "contents": "\n\nContents\nPrerequisites\nConfigural Invariance\nWeak Invariance\nStrong Invariance\nStrict Invariance\n\nPrerequisites\nTo access the datasets, help pages, and functions that we will use in this code snippet, load the following packages:\n\n\nlibrary(lavaan)\nlibrary(semTools)\n\n\nAnd read in the data:\n\n\nsocial_exchanges <- read.csv(here(\"data\", \"2021-11-01_social-exchanges.csv\"))\n\n\nThe data contains simulated values for several indicators of positive and negative social exchanges, measured on two occasions (w1 and w2). There are three continuous indicators that measure perceived companionship (vst1, vst2, vst3), and three binary indicators that measure unwanted advice (unw1, unw2, unw3). The data and some of the examples come from Longitudinal Structural Equation Modeling: A Comprehensive Introduction by Jason Newsom.\nConfigural Invariance\nUsing the lavaan package.\n\n\nconfigural_model_lav <- '\n  # Measurement model\n  w1comp =~ w1vst1 + w1vst2 + w1vst3\n  w2comp =~ w2vst1 + w2vst2 + w2vst3\n  \n  # Variances and covariances\n  w2comp ~~ w1comp\n  w1comp ~~ w1comp\n  w2comp ~~ w2comp\n\n  w1vst1 ~~ w1vst1\n  w1vst2 ~~ w1vst2\n  w1vst3 ~~ w1vst3\n  w2vst1 ~~ w2vst1\n  w2vst2 ~~ w2vst2\n  w2vst3 ~~ w2vst3\n\n  w1vst1 ~~ w2vst1\n  w1vst2 ~~ w2vst2\n  w1vst3 ~~ w2vst3\n'\n\nconfigural_model_lav_fit <- sem(configural_model_lav, data = social_exchanges)\n\n\nUsing the semTools package.\n\n\n# First, define the configural model, using the repeated measures factors and\n# indicators.\nconfigural_model_smt <- '\n  # Measurement model\n  w1comp =~ w1vst1 + w1vst2 + w1vst3\n  w2comp =~ w2vst1 + w2vst2 + w2vst3\n'\n\n# Second, create a named list indicating which factors are actually the same\n# latent variable measured repeatedly.\nlongitudinal_factor_names <- list(\n  comp = c(\"w1comp\", \"w2comp\")\n)\n\n# Third, generate the lavaan model syntax using semTools.\nconfigural_model_smt <- measEq.syntax(\n  configural.model = configural_model_smt,\n  longFacNames = longitudinal_factor_names,\n  ID.fac = \"std.lv\",\n  ID.cat = \"Wu.Estabrook.2016\",\n  data = social_exchanges\n)\nconfigural_model_smt <- as.character(configural_model_smt)\n\n# Finally, fit the model using lavaan.\nconfigural_model_smt_fit <- sem(configural_model_smt, data = social_exchanges)\n\n\nCompare lavaan and semTools fit measures.\nConfigural invariance is met if the model fits well, indicators load on the same factors, and loadings are all of acceptable magnitude. An alternative way of testing longitudinal configural invariance is to fit separate confirmatory factor models at each time point; configural invariance is met if the previously stated criteria hold and the measure has the same factor structure at each time point.\n\n\nfitMeasures(configural_model_lav_fit, c(\"chisq\", \"df\", \"pvalue\", \"cfi\", \"rmsea\"))\n\n#>  chisq     df pvalue    cfi  rmsea \n#>  9.911  5.000  0.078  0.997  0.041\n\nfitMeasures(configural_model_smt_fit, c(\"chisq\", \"df\", \"pvalue\", \"cfi\", \"rmsea\"))\n\n#>  chisq     df pvalue    cfi  rmsea \n#>  9.911  5.000  0.078  0.997  0.041\n\nWeak Invariance\nUsing the lavaan package.\n\n\nweak_model_lav <- '\n  # Measurement model\n  w1comp =~ w1vst1 + a*w1vst2 + b*w1vst3 # Factor loading equality constraint\n  w2comp =~ w2vst1 + a*w2vst2 + b*w2vst3 # Factor loading equality constraint\n\n  # Variances and covariances\n  w2comp ~~ w1comp\n  w1comp ~~ w1comp\n  w2comp ~~ w2comp\n\n  w1vst1 ~~ w1vst1\n  w1vst2 ~~ w1vst2\n  w1vst3 ~~ w1vst3\n  w2vst1 ~~ w2vst1\n  w2vst2 ~~ w2vst2\n  w2vst3 ~~ w2vst3\n\n  w1vst1 ~~ w2vst1\n  w1vst2 ~~ w2vst2\n  w1vst3 ~~ w2vst3\n'\n\nweak_model_lav_fit <- sem(weak_model_lav, social_exchanges)\n\n\nUsing the semTools package.\n\n\nweak_model_smt <- measEq.syntax(\n  configural.model = configural_model_smt,\n  longFacNames = longitudinal_factor_names,\n  ID.fac = \"std.lv\",\n  ID.cat = \"Wu.Estabrook.2016\",\n  long.equal = c(\"loadings\"),\n  data = social_exchanges\n)\nweak_model_smt <- as.character(weak_model_smt)\n\nweak_model_smt_fit <- sem(weak_model_smt, data = social_exchanges)\n\n\nCompare lavaan and semTools fit measures.\n\n\nfitMeasures(weak_model_lav_fit, c(\"chisq\", \"df\", \"pvalue\", \"cfi\", \"rmsea\"))\n\n#>  chisq     df pvalue    cfi  rmsea \n#> 12.077  7.000  0.098  0.997  0.036\n\nfitMeasures(weak_model_smt_fit, c(\"chisq\", \"df\", \"pvalue\", \"cfi\", \"rmsea\"))\n\n#>  chisq     df pvalue    cfi  rmsea \n#> 12.077  7.000  0.098  0.997  0.036\n\nTest weak invariance.\n\n\nlavTestLRT(configural_model_lav_fit, weak_model_lav_fit)\n\n#> Chi-Squared Difference Test\n#> \n#>                          Df    AIC    BIC   Chisq Chisq diff Df diff\n#> configural_model_lav_fit  5 8852.6 8922.2  9.9108                   \n#> weak_model_lav_fit        7 8850.7 8911.7 12.0767      2.166       2\n#>                          Pr(>Chisq)\n#> configural_model_lav_fit           \n#> weak_model_lav_fit           0.3386\n\nStrong Invariance\nUsing the lavaan package.\nEquality tests of factor variances should only be conducted when all factor loadings also are constrained to be equal over time. When all non-referent loadings are set equal in the constrained model, the chi-square is the same regardless of the referent.\n\n\nstrong_model_lav <- '\n  # Measurement model\n  w1comp =~ w1vst1 + a*w1vst2 + b*w1vst3 # Factor loading equality constraint\n  w2comp =~ w2vst1 + a*w2vst2 + b*w2vst3 # Factor loading equality constraint\n\n  # Variances and covariances\n  w2comp ~~ w1comp\n  w2comp ~~ v*w2comp # Factor variance equality constraint\n  w1comp ~~ v*w1comp # Factor variance equality constraint\n\n  w1vst1 ~~ w2vst1\n  w1vst2 ~~ w2vst2\n  w1vst3 ~~ w2vst3\n'\n\nstrong_model_lav_fit <- sem(strong_model_lav, social_exchanges)\n\n\nUsing the semTools package.\n\n\n# Example 2.2\nstrong_model_smt <- measEq.syntax(\n  configural.model = configural_model_smt,\n  longFacNames = longitudinal_factor_names,\n  ID.fac = \"std.lv\",\n  ID.cat = \"Wu.Estabrook.2016\",\n  long.equal = c(\"loadings\", \"lv.variances\"),\n  data = social_exchanges\n)\nstrong_model_smt <- as.character(strong_model_smt)\n\nstrong_model_smt_fit <- sem(strong_model_smt, social_exchanges)\n\n\nCompare lavaan and semTools fit measures.\n\n\nfitMeasures(strong_model_lav_fit, c(\"chisq\", \"df\", \"pvalue\", \"cfi\", \"rmsea\"))\n\n#>  chisq     df pvalue    cfi  rmsea \n#> 37.553  8.000  0.000  0.983  0.080\n\nfitMeasures(strong_model_smt_fit, c(\"chisq\", \"df\", \"pvalue\", \"cfi\", \"rmsea\"))\n\n#>  chisq     df pvalue    cfi  rmsea \n#> 37.553  8.000  0.000  0.983  0.080\n\nTest strong invariance.\n\n\nlavTestLRT(configural_model_lav_fit, weak_model_lav_fit, strong_model_lav_fit)\n\n#> Chi-Squared Difference Test\n#> \n#>                          Df    AIC    BIC   Chisq Chisq diff Df diff\n#> configural_model_lav_fit  5 8852.6 8922.2  9.9108                   \n#> weak_model_lav_fit        7 8850.7 8911.7 12.0767      2.166       2\n#> strong_model_lav_fit      8 8874.2 8930.8 37.5531     25.476       1\n#>                          Pr(>Chisq)    \n#> configural_model_lav_fit               \n#> weak_model_lav_fit           0.3386    \n#> strong_model_lav_fit      4.478e-07 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nStrict Invariance\nUsing the lavaan package.\n\n\nstrict_model_lav <- '\n  # Measurement model\n  w1comp =~ w1vst1 + a*w1vst2 + b*w1vst3 # Factor loading equality constraint\n  w2comp =~ w2vst1 + a*w2vst2 + b*w2vst3 # Factor loading equality constraint\n\n  # Variances & covariances\n  w2comp ~~ w1comp\n\n  w1comp ~~ c*w1comp # Factor variance equality constraint\n  w2comp ~~ c*w2comp # Factor variance equality constraint\n\n  w1vst1 ~~ w2vst1\n  w1vst2 ~~ w2vst2\n  w1vst3 ~~ w2vst3\n\n  w1vst1 ~~ d*w1vst1 # Measurement residual equality constraint\n  w1vst2 ~~ e*w1vst2 # Measurement residual equality constraint\n  w1vst3 ~~ f*w1vst3 # Measurement residual equality constraint\n\n  w2vst1 ~~ d*w2vst1 # Measurement residual equality constraint\n  w2vst2 ~~ e*w2vst2 # Measurement residual equality constraint\n  w2vst3 ~~ f*w2vst3 # Measurement residual equality constraint\n'\n\nstrict_model_lav_fit <- sem(strict_model_lav, social_exchanges)\n\n\nUsing the semTools package.\n\n\nstrict_model_smt <- measEq.syntax(\n  configural.model = configural_model_smt,\n  longFacNames = longitudinal_factor_names,\n  ID.fac = \"std.lv\",\n  ID.cat = \"Wu.Estabrook.2016\",\n  long.equal = c(\"loadings\", \"lv.variances\", \"residuals\"),\n  data = social_exchanges\n)\nstrict_model_smt <- as.character(strict_model_smt)\n\nstrict_model_smt_fit <- sem(strict_model_smt, social_exchanges)\n\n\nCompare lavaan and semTools fit measures.\n\n\nfitMeasures(strict_model_lav_fit, c(\"chisq\", \"df\", \"pvalue\", \"cfi\", \"rmsea\"))\n\n#>  chisq     df pvalue    cfi  rmsea \n#> 78.779 11.000  0.000  0.961  0.104\n\nfitMeasures(strict_model_smt_fit, c(\"chisq\", \"df\", \"pvalue\", \"cfi\", \"rmsea\"))\n\n#>  chisq     df pvalue    cfi  rmsea \n#> 78.779 11.000  0.000  0.961  0.104\n\nTest strict invariance.\n\n\nlavTestLRT(\n  configural_model_lav_fit,\n  weak_model_lav_fit,\n  strong_model_lav_fit,\n  strict_model_lav_fit\n)\n\n#> Chi-Squared Difference Test\n#> \n#>                          Df    AIC    BIC   Chisq Chisq diff Df diff\n#> configural_model_lav_fit  5 8852.6 8922.2  9.9108                   \n#> weak_model_lav_fit        7 8850.7 8911.7 12.0767      2.166       2\n#> strong_model_lav_fit      8 8874.2 8930.8 37.5531     25.476       1\n#> strict_model_lav_fit     11 8909.4 8952.9 78.7786     41.226       3\n#>                          Pr(>Chisq)    \n#> configural_model_lav_fit               \n#> weak_model_lav_fit           0.3386    \n#> strong_model_lav_fit      4.478e-07 ***\n#> strict_model_lav_fit      5.857e-09 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\n\n\n",
    "preview": {},
    "last_modified": "2022-10-28T14:52:30-07:00",
    "input_file": "longitudinal-measurement-invariance.knit.md"
  }
]
